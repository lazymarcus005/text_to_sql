apiVersion: v1                                                            
kind: Service                                                             
metadata:                                                                 
  name: agentic-api-service                                               
spec:                                                                     
  ports:                                                                  
    - name: http                                                          
      port: 80                                                            
      protocol: TCP                                                       
      targetPort: 8000                                                    
  # ไม่มี selector เพราะ backend ไม่ได้เป็น pod ใน k8s                    
---                                                                       
apiVersion: v1                                                            
kind: Endpoints                                                           
metadata:                                                                 
  name: agentic-api-service                                               
subsets:                                                                  
  - addresses:                                                            
      # ใส่ IP ของ VM/Node ที่ docker compose bind port 8000 ไว้          
      - ip: 144.126.140.118
    ports:                                                                
      - name: http                                                        
        port: 8000                                                        
        protocol: TCP                                                     
---                                                                       
apiVersion: networking.k8s.io/v1                                          
kind: Ingress                                                             
metadata:                                                                 
  name: agentic-api-ingress                                               
  annotations:                                                            
    kubernetes.io/ingress.class: "nginx"                                  
    # ถ้าจะเข้าแบบ / แล้วส่งต่อไป root เลย ไม่ต้อง rewrite ก็ได้          
    # แต่ถ้าคุณจะใช้ path prefix แล้วอยากตัด prefix ให้ backend:          
    # nginx.ingress.kubernetes.io/rewrite-target: /                       
spec:                                                                     
  rules:                                                                  
    - host: text2sql.codingholiday.com                                    
      http:                                                               
        paths:                                                            
          - path: /                                                       
            pathType: Prefix                                              
            backend:                                                      
              service:                                                    
                name: agentic-api-service                                 
                port:                                                     
                  number: 80                                              
    - host: chatllm.cloud                                                 
      http:                                                               
        paths:                                                            
          - path: /                                                       
            pathType: Prefix                                              
            backend:                                                      
              service:                                                    
                name: agentic-api-service                                 
                port:                                                     
                  number: 80                                              